<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GlobalPulse | Pro News & Weather</title>
    <style>
        :root {
            --bg: #0b0f1a;
            --card-bg: #161e2e;
            --accent: #38bdf8;
            --heart: #f43f5e;
            --ticker-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
        }

        [data-theme="light"] {
            --bg: #f1f5f9; --card-bg: #ffffff; --accent: #0284c7; --ticker-bg: #e2e8f0; --text-main: #0f172a; --text-dim: #475569;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.3s, color 0.3s; }
        
        body { 
            background-color: var(--bg); color: var(--text-main); 
            font-family: 'Inter', system-ui, sans-serif; 
            min-height: 100vh; display: flex; flex-direction: column;
        }

        .sticky-nav {
            position: sticky; top: 0; z-index: 1000;
            background: var(--bg);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        /* TICKER - Label removed, 120s Slow Scroll */
        .ticker-wrap { width: 100%; height: 32px; background: var(--ticker-bg); overflow: hidden; white-space: nowrap; display: flex; align-items: center; border-bottom: 1px solid rgba(128,128,128,0.1); }
        .ticker-content { display: inline-block; padding-left: 100%; animation: ticker 120s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 2rem; font-size: 0.75rem; text-transform: uppercase; font-weight: 600; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        header { padding: 0.8rem 5%; display: flex; flex-direction: column; gap: 0.8rem; }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.2rem; font-weight: 800; color: var(--text-main); text-decoration: none; }
        .logo span { color: var(--accent); }
        
        .controls { display: flex; gap: 6px; }
        .micro-btn { 
            background: var(--card-bg); border: 1px solid var(--text-dim); color: var(--text-main); 
            width: 24px; height: 24px; border-radius: 50%; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; font-size: 0.6rem; font-weight: 800;
        }

        .search-area { display: flex; gap: 0.4rem; width: 100%; }
        .loc-input { flex: 1; background: var(--card-bg); border: 1px solid var(--text-dim); color: var(--text-main); padding: 0.6rem; border-radius: 8px; outline: none; font-size: 0.85rem; }
        .loc-btn { background: var(--accent); color: white; border: none; padding: 0 1rem; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.8rem; }

        .nav-cats { display: flex; gap: 0.5rem; padding: 0.6rem 5%; background: var(--card-bg); overflow-x: auto; scrollbar-width: none; }
        .nav-cats::-webkit-scrollbar { display: none; }
        .cat-btn { background: rgba(128,128,128,0.1); border: none; color: var(--text-main); padding: 0.5rem 1rem; border-radius: 20px; cursor: pointer; white-space: nowrap; font-size: 0.75rem; }
        .cat-btn.active { background: var(--accent); color: white; }

        .weather-panel { background: var(--card-bg); margin: 0.8rem 5%; padding: 1rem; border-radius: 12px; border: 1px solid var(--accent); }
        .weather-now { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; text-align: center; gap: 0.5rem; }
        .temp-large { font-size: 2.8rem; font-weight: 800; color: var(--accent); }
        .expand-btn { background: transparent; color: var(--accent); border: 1px solid var(--accent); padding: 0.5rem; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 0.8rem; font-size: 0.75rem; }
        
        .forecast-grid { 
            display: none; grid-template-columns: repeat(auto-fit, minmax(75px, 1fr)); 
            gap: 10px; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(128,128,128,0.2); 
        }
        .forecast-grid.active { display: grid; }
        .forecast-card { text-align: center; font-size: 0.7rem; padding: 0.5rem; background: rgba(0,0,0,0.1); border-radius: 8px; }

        .layout { flex: 1; padding: 1rem 5%; padding-bottom: 5rem; }
        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(min(100%, 300px), 1fr)); gap: 1.2rem; }
        .news-card { background: var(--card-bg); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid rgba(128,128,128,0.1); }
        .news-card img { width: 100%; height: 180px; object-fit: cover; background: #111; }
        .card-body { padding: 1rem; flex: 1; display: flex; flex-direction: column; }
        .card-body h3 { font-size: 0.95rem; line-height: 1.3; margin-bottom: 0.8rem; font-weight: 700; }
        .btn-read { margin-top: auto; background: var(--accent); color: white; text-align: center; padding: 0.7rem; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 0.8rem; }

        footer { padding: 1.5rem; text-align: center; border-top: 1px solid rgba(128,128,128,0.1); font-size: 0.7rem; color: var(--text-dim); }
        footer span { color: var(--accent); font-weight: bold; }

        #bunny-link { position: fixed; bottom: 1rem; right: 1rem; z-index: 1000; opacity: 0.4; }
        .bunny-svg { width: 30px; height: 30px; fill: white; }
        @keyframes bunnyDance { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        #bunny-link:hover .bunny-svg { animation: bunnyDance 0.5s infinite; opacity: 1; }

        @media (min-width: 768px) {
            header { flex-direction: row; justify-content: space-between; }
            .search-area { width: 300px; }
            .weather-now { text-align: left; }
            .expand-btn { width: auto; margin-top: 0; }
        }
    </style>
</head>
<body data-theme="dark">

    <div class="sticky-nav">
        <div class="ticker-wrap"><div id="ticker-content" class="ticker-content">Initializing global news feed...</div></div>
        <header>
            <div class="header-top">
                <a href="#" class="logo">Global<span>Pulse</span></a>
                <div class="controls">
                    <button id="unitBtn" class="micro-btn" onclick="toggleUnits()">F</button>
                    <button class="micro-btn" onclick="toggleTheme()">ðŸŒ“</button>
                </div>
            </div>
            <div class="search-area">
                <input type="text" id="cityInput" class="loc-input" placeholder="City (e.g. Buffalo)">
                <button class="loc-btn" onclick="searchLocation()">Update</button>
            </div>
        </header>
        <nav class="nav-cats" id="categoryNav">
            <button class="cat-btn active" onclick="changeCategory('general', this)">Top News</button>
            <button class="cat-btn" onclick="changeCategory('technology', this)">Tech</button>
            <button class="cat-btn" onclick="changeCategory('sports', this)">Sports</button>
            <button class="cat-btn" onclick="changeCategory('business', this)">Finance</button>
            <button class="cat-btn" onclick="changeCategory('science', this)">Science</button>
        </nav>
    </div>

    <section class="weather-panel">
        <div class="weather-now">
            <div>
                <div id="w-loc" style="font-weight: 800; font-size: 1.2rem;">Searching...</div>
                <div id="w-desc" style="color: var(--text-dim); margin-top: 0.2rem; font-size: 0.85rem;">Syncing data</div>
            </div>
            <div id="w-temp" class="temp-large">--Â°</div>
            <button class="expand-btn" onclick="toggleForecast()">5-Day Forecast â†“</button>
        </div>
        <div id="forecast-grid" class="forecast-grid"></div>
    </section>

    <div class="layout"><div id="news-grid" class="news-grid"></div></div>

    <footer>Â© 2025 GlobalPulse â€¢ Created by <span>ProjectM</span></footer>

    <a href="https://puffyfactory.com" target="_blank" id="bunny-link">
        <svg class="bunny-svg" viewBox="0 0 24 24"><path d="M7 2 Q6 10 9 12" stroke="white" stroke-width="2" fill="none"/><path d="M17 2 Q18 10 15 12" stroke="white" stroke-width="2" fill="none"/><circle cx="12" cy="15" r="6" fill="white" /><circle cx="10" cy="14" r="0.8" fill="#0b0f1a" /><circle cx="14" cy="14" r="0.8" fill="#0b0f1a" /><path d="M11.5 16 L12.5 16 L12 17 Z" fill="#f43f5e" /></svg>
    </a>

    <script>
        const NEWS_API_KEY = '2d3ffe08d7f14128a211edf8f45cb1c0';
        let weatherCache = null, currentUnit = 'F', currentCity = "";

        // Helper to convert State name to Abbreviation
        function getStateAbbr(stateName) {
            const states = {
                'Alabama': 'AL', 'Alaska': 'AK', 'Arizona': 'AZ', 'Arkansas': 'AR', 'California': 'CA', 'Colorado': 'CO', 'Connecticut': 'CT', 'Delaware': 'DE', 'Florida': 'FL', 'Georgia': 'GA', 'Hawaii': 'HI', 'Idaho': 'ID', 'Illinois': 'IL', 'Indiana': 'IN', 'Iowa': 'IA', 'Kansas': 'KS', 'Kentucky': 'KY', 'Louisiana': 'LA', 'Maine': 'ME', 'Maryland': 'MD', 'Massachusetts': 'MA', 'Michigan': 'MI', 'Minnesota': 'MN', 'Mississippi': 'MS', 'Missouri': 'MO', 'Montana': 'MT', 'Nebraska': 'NE', 'Nevada': 'NV', 'New Hampshire': 'NH', 'New Jersey': 'NJ', 'New Mexico': 'NM', 'New York': 'NY', 'North Carolina': 'NC', 'North Dakota': 'ND', 'Ohio': 'OH', 'Oklahoma': 'OK', 'Oregon': 'OR', 'Pennsylvania': 'PA', 'Rhode Island': 'RI', 'South Carolina': 'SC', 'South Dakota': 'SD', 'Tennessee': 'TN', 'Texas': 'TX', 'Utah': 'UT', 'Vermont': 'VT', 'Virginia': 'VA', 'Washington': 'WA', 'West Virginia': 'WV', 'Wisconsin': 'WI', 'Wyoming': 'WY'
            };
            return states[stateName] || stateName;
        }

        async function initWeather() {
            try {
                const loc = await (await fetch('https://ipapi.co/json/')).json();
                // Note: ipapi provides 'region' as the full name or code; we'll try to find lat/lon geodata for consistency
                searchLocation(loc.city);
            } catch (e) { updateAllData("New York", "NY", 40.71, -74.00); }
        }

        async function searchLocation(queryCity = null) {
            const city = queryCity || document.getElementById('cityInput').value;
            if(!city) return;
            try {
                const geo = await (await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&format=json`)).json();
                if(geo.results) {
                    const res = geo.results[0];
                    const stateAbbr = getStateAbbr(res.admin1);
                    updateAllData(res.name, stateAbbr, res.latitude, res.longitude);
                }
            } catch (e) { console.error(e); }
        }

        function updateAllData(city, state, lat, lon) {
            currentCity = city;
            document.getElementById('w-loc').innerText = `${city}, ${state}`;
            fetchWeather(lat, lon);
            fetchNews('general', city);
        }

        async function fetchWeather(lat, lon) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`;
            weatherCache = await (await fetch(url)).json();
            updateWeatherDisplay();
        }

        function updateWeatherDisplay() {
            if (!weatherCache) return;
            const cur = weatherCache.current;
            let temp = currentUnit === 'F' ? (cur.temperature_2m * 9/5 + 32) : cur.temperature_2m;
            document.getElementById('w-temp').innerText = `${Math.round(temp)}Â°`;
            document.getElementById('w-desc').innerText = getWeatherDesc(cur.weather_code);

            const daily = weatherCache.daily;
            document.getElementById('forecast-grid').innerHTML = daily.time.slice(0, 5).map((date, i) => {
                let max = daily.temperature_2m_max[i], min = daily.temperature_2m_min[i];
                if (currentUnit === 'F') { max = (max * 9/5) + 32; min = (min * 9/5) + 32; }
                return `<div class="forecast-card"><div><b>${new Date(date).toLocaleDateString([], {weekday: 'short'})}</b></div><div>${Math.round(max)}Â°/${Math.round(min)}Â°</div><div>ðŸŒ§ ${daily.precipitation_probability_max[i]}%</div></div>`;
            }).join('');
        }

        async function fetchNews(category = 'general', citySearch = "") {
            const grid = document.getElementById('news-grid');
            grid.innerHTML = "<p style='text-align:center; padding:2rem;'>Syncing satellite link...</p>";
            const proxy = "https://corsproxy.io/?";
            let q = citySearch ? `q=${citySearch}+${category}` : `category=${category}`;
            const target = `https://newsapi.org/v2/top-headlines?country=us&${q}&pageSize=24&apiKey=${NEWS_API_KEY}`;
            try {
                const res = await fetch(proxy + encodeURIComponent(target));
                const data = await res.json();
                renderNews(data.articles || []);
            } catch (e) { grid.innerHTML = "<p style='text-align:center;'>Feed offline.</p>"; }
        }

        function renderNews(articles) {
            const grid = document.getElementById('news-grid');
            const ticker = document.getElementById('ticker-content');
            ticker.innerHTML = articles.slice(0, 10).map(a => `<span class="ticker-item">${a.title.toUpperCase()} â€¢</span>`).join('');
            grid.innerHTML = articles.map(art => {
                if (!art.urlToImage) return '';
                return `<div class="news-card"><img src="${art.urlToImage}"><div class="card-body"><h3>${art.title}</h3><div style="font-size:0.7rem; color:var(--text-dim); margin-top:5px;">${art.source.name}</div><a href="${art.url}" target="_blank" class="btn-read" style="margin-top:15px;">Read Report</a></div></div>`;
            }).join('');
        }

        function changeCategory(cat, btn) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            fetchNews(cat, currentCity);
        }

        function toggleUnits() { currentUnit = currentUnit === 'C' ? 'F' : 'C'; document.getElementById('unitBtn').innerText = currentUnit; updateWeatherDisplay(); }
        function toggleForecast() { document.getElementById('forecast-grid').classList.toggle('active'); }
        function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'); }
        function getWeatherDesc(code) {
            const codes = { 0: "Clear", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Overcast", 45: "Foggy", 61: "Rain", 71: "Snow", 95: "Storm" };
            return codes[code] || "Fair";
        }

        initWeather();
    </script>
</body>
</html>
