<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GlobalPulse | Pro Interface</title>
    <style>
        :root {
            --bg: #0b0f1a;
            --card-bg: #161e2e;
            --accent: #38bdf8;
            --heart: #f43f5e;
            --ticker-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
        }

        [data-theme="light"] {
            --bg: #f1f5f9; --card-bg: #ffffff; --accent: #0284c7; --ticker-bg: #e2e8f0; --text-main: #0f172a; --text-dim: #475569;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.3s, color 0.3s; }
        
        body { 
            background-color: var(--bg); color: var(--text-main); 
            font-family: 'Inter', system-ui, sans-serif; 
            min-height: 100vh; display: flex; flex-direction: column; font-size: 16px;
        }

        /* TICKER - 120s Duration */
        .ticker-wrap { width: 100%; height: 35px; background: var(--ticker-bg); overflow: hidden; white-space: nowrap; display: flex; align-items: center; border-bottom: 1px solid rgba(128,128,128,0.2); position: sticky; top: 0; z-index: 100; }
        .ticker-label { background: var(--heart); color: white; padding: 0 0.8rem; font-weight: bold; font-size: 0.6rem; height: 100%; display: flex; align-items: center; }
        .ticker-content { display: inline-block; padding-left: 100%; animation: ticker 120s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 2rem; font-size: 0.75rem; text-transform: uppercase; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* HEADER */
        header { background: var(--bg); padding: 0.8rem 5%; display: flex; flex-direction: column; gap: 0.6rem; border-bottom: 1px solid rgba(128,128,128,0.1); }
        .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .logo { font-size: 1.1rem; font-weight: 800; color: var(--text-main); text-decoration: none; }
        .logo span { color: var(--accent); }
        
        .controls { display: flex; gap: 6px; }
        .micro-btn { 
            background: var(--card-bg); border: 1px solid var(--text-dim); color: var(--text-main); 
            width: 24px; height: 24px; border-radius: 50%; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; font-size: 0.6rem; font-weight: 800;
        }

        .search-area { display: flex; gap: 0.4rem; width: 100%; }
        .loc-input { flex: 1; background: var(--card-bg); border: 1px solid var(--text-dim); color: var(--text-main); padding: 0.5rem; border-radius: 6px; outline: none; font-size: 0.85rem; }
        .loc-btn { background: var(--accent); color: white; border: none; padding: 0 0.8rem; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 0.75rem; }

        /* WEATHER */
        .weather-panel { background: var(--card-bg); margin: 0.8rem 5%; padding: 1rem; border-radius: 10px; border: 1px solid var(--accent); }
        .weather-now { display: flex; justify-content: space-between; align-items: center; }
        .temp-large { font-size: 2.2rem; font-weight: 800; color: var(--accent); }
        .expand-btn { background: transparent; color: var(--accent); border: 1px solid var(--accent); padding: 0.4rem; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 0.8rem; font-size: 0.7rem; }
        
        .forecast-container { display: none; grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); gap: 8px; margin-top: 0.8rem; padding-top: 0.8rem; border-top: 1px solid rgba(128,128,128,0.2); }
        .forecast-container.active { display: grid; }
        .forecast-card { text-align: center; font-size: 0.65rem; padding: 0.4rem; background: rgba(0,0,0,0.1); border-radius: 6px; }

        /* NEWS GRID */
        .layout { flex: 1; padding: 1rem 5%; padding-bottom: 5rem; }
        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(min(100%, 300px), 1fr)); gap: 1rem; }
        .news-card { background: var(--card-bg); border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid rgba(128,128,128,0.1); }
        .news-card img { width: 100%; height: 160px; object-fit: cover; background: #111; }
        .card-body { padding: 0.8rem; flex: 1; display: flex; flex-direction: column; }
        .card-body h3 { font-size: 0.9rem; line-height: 1.3; margin-bottom: 0.5rem; }
        .btn-read { margin-top: auto; background: var(--accent); color: white; text-align: center; padding: 0.6rem; border-radius: 6px; text-decoration: none; font-weight: bold; font-size: 0.75rem; }

        footer { padding: 1rem; text-align: center; border-top: 1px solid rgba(128,128,128,0.1); font-size: 0.65rem; color: var(--text-dim); }
        footer span { color: var(--accent); font-weight: bold; }

        /* BUNNY */
        #bunny-link { position: fixed; bottom: 0.8rem; right: 0.8rem; z-index: 1000; opacity: 0.4; }
        .bunny-svg { width: 28px; height: 28px; fill: white; }
        @keyframes bunnyDance { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        #bunny-link:hover .bunny-svg { animation: bunnyDance 0.5s infinite; opacity: 1; }

        @media (min-width: 768px) {
            header { flex-direction: row; align-items: center; justify-content: space-between; }
            .search-area { width: 280px; }
            .expand-btn { width: auto; margin-top: 0; }
        }
    </style>
</head>
<body data-theme="dark">

    <div class="ticker-wrap"><div class="ticker-label">LATEST</div><div id="ticker-content" class="ticker-content">Syncing satellite uplink...</div></div>

    <header>
        <div class="header-top">
            <a href="#" class="logo">Global<span>Pulse</span></a>
            <div class="controls">
                <button id="unitBtn" class="micro-btn" onclick="toggleUnits()">F</button>
                <button class="micro-btn" onclick="toggleTheme()">ðŸŒ“</button>
            </div>
        </div>
        <div class="search-area">
            <input type="text" id="cityInput" class="loc-input" placeholder="City (e.g. Buffalo)">
            <button class="loc-btn" onclick="searchLocation()">Update</button>
        </div>
    </header>

    <section class="weather-panel">
        <div class="weather-now">
            <div>
                <div id="w-loc" style="font-weight: 800; font-size: 1rem;">Searching...</div>
                <div id="w-desc" style="color: var(--text-dim); font-size: 0.75rem;">Connecting...</div>
            </div>
            <div id="w-temp" class="temp-large">--Â°</div>
            <button class="expand-btn" onclick="toggleForecast()">5-Day Forecast â†“</button>
        </div>
        <div id="forecast-grid" class="forecast-container"></div>
    </section>

    <div class="layout"><div id="news-grid" class="news-grid"></div></div>

    <footer>Â© 2025 GlobalPulse â€¢ Created by <span>ProjectM</span></footer>

    <a href="https://puffyfactory.com" target="_blank" id="bunny-link">
        <svg class="bunny-svg" viewBox="0 0 24 24"><path d="M7 2 Q6 10 9 12" stroke="white" stroke-width="2" fill="none"/><path d="M17 2 Q18 10 15 12" stroke="white" stroke-width="2" fill="none"/><circle cx="12" cy="15" r="6" fill="white" /><circle cx="10" cy="14" r="0.8" fill="#0b0f1a" /><circle cx="14" cy="14" r="0.8" fill="#0b0f1a" /><path d="M11.5 16 L12.5 16 L12 17 Z" fill="#f43f5e" /></svg>
    </a>

    <script>
        const NEWS_API_KEY = '2d3ffe08d7f14128a211edf8f45cb1c0';
        let weatherCache = null, currentUnit = 'F', currentCity = "";

        // Today's Dec 17, 2025 "Intelligence Data" (Fallback if API is blocked)
        const INTEL_NEWS = [
            { title: "Treasury Secretary Scott Bessent Orders New Sanctions Against Cartels", source: "Treasury.gov", img: "https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=400" },
            { title: "Bills Defeat Patriots 35-31; Josh Allen Prepares for Browns Clash", source: "BillsMafia", img: "https://images.unsplash.com/photo-1566577739112-5180d4bf9390?w=400" },
            { title: "Ethereum (ETH) Slides to $2,822 as Market Volatility Continues", source: "CoinPulse", img: "https://images.unsplash.com/photo-1621416894569-0f39ed31d247?w=400" },
            { title: "DOT Secretary Sean Duffy Launches National Advanced Air Mobility Strategy", source: "US Gov", img: "https://images.unsplash.com/photo-1517976487492-5750f3195933?w=400" },
            { title: "HHS Launches Roy Wilkins Fellowship for HBCU Public Service Students", source: "HHS.gov", img: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400" }
        ];

        async function initWeather() {
            try {
                const loc = await (await fetch('https://ipapi.co/json/')).json();
                updateAllData(loc.city, loc.latitude, loc.longitude);
            } catch (e) { updateAllData("New York", 40.71, -74.00); }
        }

        async function searchLocation() {
            const city = document.getElementById('cityInput').value;
            if(!city) return;
            try {
                const geo = await (await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&format=json`)).json();
                if(geo.results) {
                    const res = geo.results[0];
                    updateAllData(res.name, res.latitude, res.longitude);
                }
            } catch (e) { console.error(e); }
        }

        function updateAllData(city, lat, lon) {
            currentCity = city;
            document.getElementById('w-loc').innerText = city;
            fetchWeather(lat, lon);
            fetchNews(city);
        }

        async function fetchWeather(lat, lon) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`;
            weatherCache = await (await fetch(url)).json();
            updateWeatherDisplay();
        }

        function updateWeatherDisplay() {
            if (!weatherCache) return;
            const cur = weatherCache.current;
            let temp = currentUnit === 'F' ? (cur.temperature_2m * 9/5 + 32) : cur.temperature_2m;
            document.getElementById('w-temp').innerText = `${Math.round(temp)}Â°`;
            document.getElementById('w-desc').innerText = getWeatherDesc(cur.weather_code);

            const daily = weatherCache.daily;
            document.getElementById('forecast-grid').innerHTML = daily.time.slice(0, 5).map((date, i) => {
                let max = daily.temperature_2m_max[i], min = daily.temperature_2m_min[i];
                if (currentUnit === 'F') { max = (max * 9/5) + 32; min = (min * 9/5) + 32; }
                return `<div class="forecast-card"><div><b>${new Date(date).toLocaleDateString([], {weekday: 'short'})}</b></div><div>${Math.round(max)}Â°/${Math.round(min)}Â°</div><div>ðŸŒ§ ${daily.precipitation_probability_max[i]}%</div></div>`;
            }).join('');
        }

        async function fetchNews(city = "") {
            const grid = document.getElementById('news-grid');
            grid.innerHTML = "<p style='text-align:center;'>Updating Intel...</p>";
            
            // Using a free CORS proxy - sometimes these are hit/miss
            const proxy = "https://corsproxy.io/?";
            const target = `https://newsapi.org/v2/everything?q=${city}+news&pageSize=12&apiKey=${NEWS_API_KEY}`;
            
            try {
                const res = await fetch(proxy + encodeURIComponent(target));
                const data = await res.json();
                if(data.articles && data.articles.length > 0) renderNews(data.articles);
                else throw "Empty";
            } catch (e) { 
                console.log("CORS block or empty result. Loading intel fallback.");
                renderNews(INTEL_NEWS, true); 
            }
        }

        function renderNews(articles, isFallback = false) {
            const grid = document.getElementById('news-grid');
            const ticker = document.getElementById('ticker-content');
            ticker.innerHTML = articles.slice(0, 8).map(a => `<span class="ticker-item">${a.title.toUpperCase()} â€¢</span>`).join('');
            grid.innerHTML = articles.map(art => `
                <div class="news-card">
                    <img src="${art.urlToImage || art.img || 'https://via.placeholder.com/400x200'}">
                    <div class="card-body">
                        <h3>${art.title}</h3>
                        <div style="font-size:0.7rem; color:var(--text-dim); margin-top:5px;">${art.source.name || art.source}</div>
                        <a href="${art.url || '#'}" target="_blank" class="btn-read" style="margin-top:15px;">Access Report</a>
                    </div>
                </div>
            `).join('');
            if(isFallback) grid.insertAdjacentHTML('afterbegin', '<p style="grid-column:1/-1; text-align:center; font-size:0.7rem; color:var(--accent);">Intel Sync: Live Offline. Loading Fallback Data.</p>');
        }

        function toggleUnits() { currentUnit = currentUnit === 'C' ? 'F' : 'C'; document.getElementById('unitBtn').innerText = currentUnit; updateWeatherDisplay(); }
        function toggleForecast() { document.getElementById('forecast-grid').classList.toggle('active'); }
        function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'); }
        function getWeatherDesc(code) {
            const codes = { 0: "Clear", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Overcast", 45: "Foggy", 61: "Rain", 71: "Snow", 95: "Storm" };
            return codes[code] || "Fair";
        }

        initWeather();
    </script>
</body>
</html>
