<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlobalPulse | Pro News & Weather</title>
    <style>
        :root {
            --bg: #0b0f1a;
            --card-bg: #161e2e;
            --accent: #38bdf8;
            --heart: #f43f5e;
            --ticker-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
        }

        [data-theme="light"] {
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --accent: #0284c7;
            --ticker-bg: #e2e8f0;
            --text-main: #0f172a;
            --text-dim: #475569;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.3s, color 0.3s; }
        body { background-color: var(--bg); color: var(--text-main); font-family: 'Inter', system-ui, sans-serif; position: relative; min-height: 100vh; }

        /* TICKER */
        .ticker-wrap { width: 100%; height: 40px; background: var(--ticker-bg); overflow: hidden; white-space: nowrap; display: flex; align-items: center; border-bottom: 1px solid rgba(128,128,128,0.2); }
        .ticker-label { background: var(--heart); color: white; padding: 0 15px; font-weight: bold; font-size: 0.8rem; height: 100%; display: flex; align-items: center; z-index: 2; }
        .ticker-content { display: inline-block; padding-left: 100%; animation: ticker 120s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 30px; font-size: 0.9rem; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* HEADER */
        header { background: var(--bg); padding: 1rem 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(128,128,128,0.1); }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--text-main); text-decoration: none; }
        .logo span { color: var(--accent); }
        
        /* UNIT TOGGLE (Smaller) */
        .unit-btn { 
            background: var(--accent); 
            color: white; 
            border: none; 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-weight: 800; 
            font-size: 0.8rem; 
            box-shadow: 0 2px 6px rgba(56, 189, 248, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* NAVIGATION */
        .nav-cats { display: flex; gap: 10px; padding: 15px 5%; background: var(--card-bg); overflow-x: auto; scrollbar-width: none; border-bottom: 1px solid rgba(128,128,128,0.1); }
        .cat-btn { background: rgba(128,128,128,0.1); border: 1px solid transparent; color: var(--text-main); padding: 6px 16px; border-radius: 20px; cursor: pointer; white-space: nowrap; font-size: 0.85rem; }
        .cat-btn.active { background: var(--accent); color: white; }

        /* WEATHER PANEL */
        .weather-panel { background: var(--card-bg); margin: 20px 5%; padding: 25px; border-radius: 12px; border: 1px solid var(--accent); }
        .weather-now { display: flex; justify-content: space-between; align-items: center; }
        .temp-large { font-size: 3.5rem; font-weight: 800; color: var(--accent); }
        .expand-btn { background: transparent; color: var(--accent); border: 1px solid var(--accent); padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        .forecast-container { display: none; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 25px; padding-top: 25px; border-top: 1px solid rgba(128,128,128,0.2); }
        .forecast-container.active { display: grid; }
        .forecast-card { text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; font-size: 0.85rem; }

        /* NEWS GRID */
        .layout { max-width: 1400px; margin: 0 auto; padding: 20px; padding-bottom: 80px; }
        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }
        .news-card { background: var(--card-bg); border-radius: 14px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid rgba(128,128,128,0.1); }
        .news-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .news-card img { width: 100%; height: 210px; object-fit: cover; background: #1a1a1a; }
        .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .btn-read { margin-top: auto; background: var(--accent); color: white; text-align: center; padding: 12px; border-radius: 8px; text-decoration: none; font-weight: 700; }

        /* BUNNY GATEKEEPER */
        #bunny-link {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            text-decoration: none;
            opacity: 0.4;
            transition: opacity 0.3s;
        }
        #bunny-link:hover { opacity: 1; }
        .bunny-svg { width: 28px; height: 28px; fill: white; }

        @keyframes bunnyDance {
            0%, 100% { transform: translateY(0) rotate(0); }
            25% { transform: translateY(-4px) rotate(-10deg); }
            50% { transform: translateY(0) rotate(0); }
            75% { transform: translateY(-4px) rotate(10deg); }
        }

        #bunny-link:hover .bunny-svg { animation: bunnyDance 0.5s infinite ease-in-out; }
    </style>
</head>
<body data-theme="dark">

    <div class="ticker-wrap"><div class="ticker-label">BREAKING</div><div id="ticker-content" class="ticker-content">Syncing global news satellites...</div></div>

    <header>
        <a href="#" class="logo">Global<span>Pulse</span></a>
        <div style="display: flex; gap: 12px; align-items: center;">
            <button id="unitBtn" class="unit-btn" onclick="toggleUnits()">Â°F</button>
            <button onclick="toggleTheme()" style="background:none; border:none; font-size: 1.4rem; cursor:pointer;">ðŸŒ“</button>
        </div>
    </header>

    <nav class="nav-cats" id="categoryNav">
        <button class="cat-btn active" onclick="changeCategory('general', this)">All News</button>
        <button class="cat-btn" onclick="changeCategory('technology', this)">Technology</button>
        <button class="cat-btn" onclick="changeCategory('sports', this)">Sports</button>
        <button class="cat-btn" onclick="changeCategory('business', this)">Finance</button>
        <button class="cat-btn" onclick="changeCategory('entertainment', this)">Entertainment</button>
        <button class="cat-btn" onclick="changeCategory('health', this)">Health</button>
        <button class="cat-btn" onclick="changeCategory('science', this)">Science</button>
    </nav>

    <section class="weather-panel">
        <div class="weather-now">
            <div>
                <div id="w-loc" style="font-weight: 800; font-size: 1.2rem;">Detecting Location...</div>
                <div id="w-desc" style="color: var(--text-dim);">Fetching conditions</div>
            </div>
            <div id="w-temp" class="temp-large">--Â°</div>
            <button class="expand-btn" onclick="toggleForecast()">View 5-Day Forecast â†“</button>
        </div>
        <div id="forecast-grid" class="forecast-container"></div>
    </section>

    <div class="layout"><div id="news-grid" class="news-grid"></div></div>

    <a href="https://puffyfactory.com" target="_blank" id="bunny-link">
        <svg class="bunny-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 2 Q6 10 9 12" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/>
            <path d="M17 2 Q18 10 15 12" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/>
            <circle cx="12" cy="15" r="6" fill="white" />
            <circle cx="10" cy="14" r="0.8" fill="#0b0f1a" />
            <circle cx="14" cy="14" r="0.8" fill="#0b0f1a" />
            <path d="M11.5 16 L12.5 16 L12 17 Z" fill="#f43f5e" />
        </svg>
    </a>

    <script>
        const NEWS_API_KEY = '2d3ffe08d7f14128a211edf8f45cb1c0';
        let weatherCache = null;
        let currentUnit = 'F';

        async function initWeather() {
            try {
                const loc = await (await fetch('https://ipapi.co/json/')).json();
                document.getElementById('w-loc').innerText = `${loc.city}, ${loc.region}`;
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${loc.latitude}&longitude=${loc.longitude}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,wind_speed_10m_max&timezone=auto`;
                weatherCache = await (await fetch(url)).json();
                updateWeatherDisplay();
            } catch (e) { document.getElementById('w-loc').innerText = "Offline"; }
        }

        function toggleUnits() {
            currentUnit = currentUnit === 'C' ? 'F' : 'C';
            document.getElementById('unitBtn').innerText = `Â°${currentUnit}`;
            updateWeatherDisplay();
        }

        function updateWeatherDisplay() {
            if (!weatherCache) return;
            const cur = weatherCache.current;
            let temp = currentUnit === 'F' ? (cur.temperature_2m * 9/5 + 32) : cur.temperature_2m;
            document.getElementById('w-temp').innerText = `${Math.round(temp)}Â°`;
            document.getElementById('w-desc').innerText = getWeatherDesc(cur.weather_code);

            const daily = weatherCache.daily;
            document.getElementById('forecast-grid').innerHTML = daily.time.slice(0, 5).map((date, i) => {
                let max = daily.temperature_2m_max[i];
                let min = daily.temperature_2m_min[i];
                if (currentUnit === 'F') { max = (max * 9/5) + 32; min = (min * 9/5) + 32; }
                return `
                    <div class="forecast-card">
                        <div style="font-weight:bold; color:var(--accent);">${new Date(date).toLocaleDateString([], {weekday: 'short'})}</div>
                        <div>${Math.round(max)}Â° / ${Math.round(min)}Â°</div>
                        <div style="font-size:0.7rem; color:var(--text-dim);">ðŸŒ§ ${daily.precipitation_probability_max[i]}%</div>
                    </div>
                `;
            }).join('');
        }

        function toggleForecast() {
            const grid = document.getElementById('forecast-grid');
            grid.classList.toggle('active');
            document.querySelector('.expand-btn').innerText = grid.classList.contains('active') ? "Hide Forecast â†‘" : "View 5-Day Forecast â†“";
        }

        function getWeatherDesc(code) {
            const codes = { 0: "Clear", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Overcast", 45: "Foggy", 61: "Rain", 71: "Snow", 95: "Thunderstorm" };
            return codes[code] || "Fair";
        }

        async function fetchNews(category = 'general') {
            const grid = document.getElementById('news-grid');
            grid.innerHTML = "<p>Scanning headlines...</p>";
            const proxy = "https://corsproxy.io/?";
            const target = `https://newsapi.org/v2/top-headlines?country=us&category=${category}&pageSize=40&apiKey=${NEWS_API_KEY}`;
            try {
                const res = await fetch(proxy + encodeURIComponent(target));
                const data = await res.json();
                renderNews(data.articles);
            } catch (e) { grid.innerHTML = "<p>Uplink Failed.</p>"; }
        }

        function renderNews(articles) {
            const grid = document.getElementById('news-grid');
            document.getElementById('ticker-content').innerHTML = articles.slice(0, 15).map(a => `<span class="ticker-item">${a.title.toUpperCase()} â€¢</span>`).join('');
            grid.innerHTML = articles.map(art => {
                if (!art.urlToImage) return '';
                return `
                    <div class="news-card">
                        <img src="${art.urlToImage}" alt="news">
                        <div class="card-body">
                            <h3 style="font-size:1.1rem; line-height:1.3; font-weight:700;">${art.title}</h3>
                            <div style="font-size:0.75rem; color:var(--text-dim); margin-top:10px;">${art.source.name} â€¢ ${new Date(art.publishedAt).toLocaleDateString()}</div>
                            <a href="${art.url}" target="_blank" class="btn-read" style="margin-top:20px;">Read Full Story</a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function changeCategory(cat, btn) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            fetchNews(cat);
        }

        function toggleTheme() {
            document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        }

        initWeather();
        fetchNews();
    </script>
</body>
</html>